(function(){var $,cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlash,hasTextSelected,luhnCheck,reFormatCardNumber,reFormatExpiry,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,setCardType,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};($=jQuery).payment={},$.payment.fn={},$.fn.payment=function(argument_0){var args,method;return method=argument_0,args=2<=arguments.length?__slice.call(arguments,1):[],$.payment.fn[method].apply(this,args)},cards=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:defaultFormat=/(\d{1,4})/g,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:defaultFormat,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[0-5]/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",pattern:/^3[0689]/,format:defaultFormat,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^6([045]|22)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^(62|88)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0}],cardFromNumber=function(num){var card,_i,_len;for(num=(num+"").replace(/\D/g,""),_i=0,_len=cards.length;_i<_len;_i++)if((card=cards[_i]).pattern.test(num))return card},cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_i<_len;_i++)if((card=cards[_i]).type===type)return card},luhnCheck=function(num){var digit,digits,odd,sum,_i,_len;for(odd=!0,_i=sum=0,_len=(digits=(num+"").split("").reverse()).length;_i<_len;_i++)digit=digits[_i],digit=parseInt(digit,10),(odd=!odd)&&(digit*=2),9<digit&&(digit-=9),sum+=digit;return sum%10==0},hasTextSelected=function($target){var _ref;return null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==$target.prop("selectionEnd")||!("undefined"==typeof document||null===document||null==(_ref=document.selection)||"function"!=typeof _ref.createRange||!_ref.createRange().text)},reFormatCardNumber=function(e){return setTimeout(function(){var $target,value;return value=($target=$(e.currentTarget)).val(),value=$.payment.formatCardNumber(value),$target.val(value)})},formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;if(digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&($target=$(e.currentTarget),value=$target.val(),card=cardFromNumber(value+digit),length=(value.replace(/\D/g,"")+digit).length,upperLength=16,card&&(upperLength=card.length[card.length.length-1]),!(upperLength<=length||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length)))return(re=card&&"amex"===card.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/).test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value+" "+digit)})):re.test(value+digit)?(e.preventDefault(),setTimeout(function(){return $target.val(value+digit+" ")})):void 0},formatBackCardNumber=function(e){var $target,value;if($target=$(e.currentTarget),value=$target.val(),8===e.which&&(null==$target.prop("selectionStart")||$target.prop("selectionStart")===value.length))return/\d\s$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d\s$/,""))})):/\s\d?$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\s\d?$/,""))})):void 0},reFormatExpiry=function(e){return setTimeout(function(){var $target,value;return value=($target=$(e.currentTarget)).val(),value=$.payment.formatExpiry(value),$target.val(value)})},formatExpiry=function(e){var $target,digit,val;if(digit=String.fromCharCode(e.which),/^\d+$/.test(digit))return $target=$(e.currentTarget),val=$target.val()+digit,/^\d$/.test(val)&&"0"!==val&&"1"!==val?(e.preventDefault(),setTimeout(function(){return $target.val("0"+val+" / ")})):/^\d\d$/.test(val)?(e.preventDefault(),setTimeout(function(){return $target.val(val+" / ")})):void 0},formatForwardExpiry=function(e){var $target,digit,val;if(digit=String.fromCharCode(e.which),/^\d+$/.test(digit))return val=($target=$(e.currentTarget)).val(),/^\d\d$/.test(val)?$target.val(val+" / "):void 0},formatForwardSlash=function(e){var $target,val;if("/"===String.fromCharCode(e.which))return val=($target=$(e.currentTarget)).val(),/^\d$/.test(val)&&"0"!==val?$target.val("0"+val+" / "):void 0},formatBackExpiry=function(e){var $target,value;if($target=$(e.currentTarget),value=$target.val(),8===e.which&&(null==$target.prop("selectionStart")||$target.prop("selectionStart")===value.length))return/\s\/\s\d?$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\s\/\s\d?$/,""))})):void 0},restrictNumeric=function(e){var input;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(input=String.fromCharCode(e.which),!!/[\d\s]/.test(input))))},restrictCardNumber=function(e){var $target,card,digit,value;if($target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target))return value=($target.val()+digit).replace(/\D/g,""),(card=cardFromNumber(value))?value.length<=card.length[card.length.length-1]:value.length<=16},restrictExpiry=function(e){var $target,digit;if($target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target))return!(6<($target.val()+digit).replace(/\D/g,"").length)&&void 0},restrictCVC=function(e){var $target,digit;if($target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target))return($target.val()+digit).length<=4},setCardType=function(e){var $target,allTypes,card,cardType,val;if(val=($target=$(e.currentTarget)).val(),cardType=$.payment.cardType(val)||"unknown",!$target.hasClass(cardType))return allTypes=function(){var _i,_len,_results;for(_results=[],_i=0,_len=cards.length;_i<_len;_i++)card=cards[_i],_results.push(card.type);return _results}(),$target.removeClass("unknown"),$target.removeClass(allTypes.join(" ")),$target.addClass(cardType),$target.toggleClass("identified","unknown"!==cardType),$target.trigger("payment.cardType",cardType)},$.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictCVC),this},$.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictExpiry),this.on("keypress",formatExpiry),this.on("keypress",formatForwardSlash),this.on("keypress",formatForwardExpiry),this.on("keydown",formatBackExpiry),this.on("change",reFormatExpiry),this.on("input",reFormatExpiry),this},$.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictCardNumber),this.on("keypress",formatCardNumber),this.on("keydown",formatBackCardNumber),this.on("keyup",setCardType),this.on("paste",reFormatCardNumber),this.on("change",reFormatCardNumber),this.on("input",reFormatCardNumber),this.on("input",setCardType),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",restrictNumeric),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(value){var month,year,_ref;return month=(_ref=(value=value.replace(/\s/g,"")).split("/",2))[0],2===(null!=(year=_ref[1])?year.length:void 0)&&/^\d+$/.test(year)&&(year=(new Date).getFullYear().toString().slice(0,2)+year),{month:month=parseInt(month,10),year:year=parseInt(year,10)}},$.payment.validateCardNumber=function(num){var card,_ref;return num=(num+"").replace(/\s+|-/g,""),!!/^\d+$/.test(num)&&(!!(card=cardFromNumber(num))&&(_ref=num.length,0<=__indexOf.call(card.length,_ref)&&(!1===card.luhn||luhnCheck(num))))},$.payment.validateCardExpiry=function(month,year){var currentTime,expiry,_ref;return"object"==typeof month&&"month"in month&&(month=(_ref=month).month,year=_ref.year),!(!month||!year)&&(month=$.trim(month),year=$.trim(year),!!/^\d+$/.test(month)&&(!!/^\d+$/.test(year)&&(1<=month&&month<=12&&(2===year.length&&(year=year<70?"20"+year:"19"+year),4===year.length&&(expiry=new Date(year,month),currentTime=new Date,expiry.setMonth(expiry.getMonth()-1),expiry.setMonth(expiry.getMonth()+1,1),currentTime<expiry)))))},$.payment.validateCardCVC=function(cvc,type){var _ref,_ref1;return cvc=$.trim(cvc),!!/^\d+$/.test(cvc)&&(type?(_ref=cvc.length,0<=__indexOf.call(null!=(_ref1=cardFromType(type))?_ref1.cvcLength:void 0,_ref)):3<=cvc.length&&cvc.length<=4)},$.payment.cardType=function(num){var _ref;return num&&(null!=(_ref=cardFromNumber(num))?_ref.type:void 0)||null},$.payment.formatCardNumber=function(num){var card,groups,upperLength,_ref;return(card=cardFromNumber(num))?(upperLength=card.length[card.length.length-1],num=(num=num.replace(/\D/g,"")).slice(0,upperLength),card.format.global?null!=(_ref=num.match(card.format))?_ref.join(" "):void 0:null!=(groups=card.format.exec(num))?(groups.shift(),(groups=$.grep(groups,function(n){return n})).join(" ")):void 0):num},$.payment.formatExpiry=function(expiry){var mon,parts,sep,year;return(parts=expiry.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(mon=parts[1]||"",sep=parts[2]||"",(0<(year=parts[3]||"").length||0<sep.length&&!/\ \/?\ ?/.test(sep))&&(sep=" / "),1===mon.length&&"0"!==mon&&"1"!==mon&&(mon="0"+mon,sep=" / "),mon+sep+year):""}}).call(this);