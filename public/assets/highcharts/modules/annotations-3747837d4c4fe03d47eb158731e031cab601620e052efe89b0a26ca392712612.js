!function(Highcharts,HighchartsAdapter){function defaultOptions(shapeType){var shapeOptions,options;return options={xAxis:0,yAxis:0,title:{style:{},text:"",x:0,y:0},shape:{params:{stroke:"#000000",fill:"transparent",strokeWidth:2}}},shapeOptions={circle:{params:{x:0,y:0}}},shapeOptions[shapeType]&&(options.shape=merge(options.shape,shapeOptions[shapeType])),options}function isArray(obj){return"[object Array]"===Object.prototype.toString.call(obj)}function isNumber(n){return"number"==typeof n}function defined(obj){return obj!==UNDEFINED&&null!==obj}function translatePath(d,xAxis,yAxis,xOffset,yOffset){for(var len=d.length,i=0;len>i;)"number"==typeof d[i]&&"number"==typeof d[i+1]?(d[i]=xAxis.toPixels(d[i])-xOffset,d[i+1]=yAxis.toPixels(d[i+1])-yOffset,i+=2):i+=1;return d}var UNDEFINED,ALIGN_FACTOR,ALLOWED_SHAPES,Chart=Highcharts.Chart,extend=Highcharts.extend,each=Highcharts.each;ALLOWED_SHAPES=["path","rect","circle"],ALIGN_FACTOR={top:0,left:0,center:.5,middle:.5,bottom:1,right:1};var inArray=HighchartsAdapter.inArray,merge=Highcharts.merge,Annotation=function(){this.init.apply(this,arguments)};Annotation.prototype={init:function(chart,options){var shapeType=options.shape&&options.shape.type;this.chart=chart,this.options=merge({},defaultOptions(shapeType),options)},render:function(redraw){var annotation=this,chart=this.chart,renderer=annotation.chart.renderer,group=annotation.group,title=annotation.title,shape=annotation.shape,options=annotation.options,titleOptions=options.title,shapeOptions=options.shape;group||(group=annotation.group=renderer.g()),!shape&&shapeOptions&&-1!==inArray(shapeOptions.type,ALLOWED_SHAPES)&&(shape=annotation.shape=renderer[options.shape.type](shapeOptions.params),shape.add(group)),!title&&titleOptions&&(title=annotation.title=renderer.label(titleOptions),title.add(group)),group.add(chart.annotations.group),annotation.linkObjects(),redraw!==!1&&annotation.redraw()},redraw:function(){var shapeParams,linkType,series,param,bbox,x,y,options=this.options,chart=this.chart,group=this.group,title=this.title,shape=this.shape,linkedTo=this.linkedObject,xAxis=chart.xAxis[options.xAxis],yAxis=chart.yAxis[options.yAxis],width=options.width,height=options.height,anchorY=ALIGN_FACTOR[options.anchorY],anchorX=ALIGN_FACTOR[options.anchorX],resetBBox=!1;if(linkedTo&&(linkType=linkedTo instanceof Highcharts.Point?"point":linkedTo instanceof Highcharts.Series?"series":null,"point"===linkType?(options.xValue=linkedTo.x,options.yValue=linkedTo.y,series=linkedTo.series):"series"===linkType&&(series=linkedTo),group.visibility!==series.group.visibility&&group.attr({visibility:series.group.visibility})),x=defined(options.xValue)?xAxis.toPixels(options.xValue+xAxis.minPointOffset)-xAxis.minPixelPadding:options.x,y=defined(options.yValue)?yAxis.toPixels(options.yValue):options.y,!isNaN(x)&&!isNaN(y)&&isNumber(x)&&isNumber(y)){if(title&&(title.attr(options.title),title.css(options.title.style),resetBBox=!0),shape){if(shapeParams=extend({},options.shape.params),"values"===options.units){for(param in shapeParams)inArray(param,["width","x"])>-1?shapeParams[param]=xAxis.translate(shapeParams[param]):inArray(param,["height","y"])>-1&&(shapeParams[param]=yAxis.translate(shapeParams[param]));shapeParams.width&&(shapeParams.width-=xAxis.toPixels(0)-xAxis.left),shapeParams.x&&(shapeParams.x+=xAxis.minPixelPadding),"path"===options.shape.type&&translatePath(shapeParams.d,xAxis,yAxis,x,y)}"circle"===options.shape.type&&(shapeParams.x+=shapeParams.r,shapeParams.y+=shapeParams.r),resetBBox=!0,shape.attr(shapeParams)}group.bBox=null,isNumber(width)||(bbox=group.getBBox(),width=bbox.width),isNumber(height)||(bbox||(bbox=group.getBBox()),height=bbox.height),isNumber(anchorX)||(anchorX=ALIGN_FACTOR.center),isNumber(anchorY)||(anchorY=ALIGN_FACTOR.center),x-=width*anchorX,y-=height*anchorY,chart.animation&&defined(group.translateX)&&defined(group.translateY)?group.animate({translateX:x,translateY:y}):group.translate(x,y)}},destroy:function(){var annotation=this,chart=this.chart,allItems=chart.annotations.allItems,index=allItems.indexOf(annotation);index>-1&&allItems.splice(index,1),each(["title","shape","group"],function(element){annotation[element]&&(annotation[element].destroy(),annotation[element]=null)}),annotation.group=annotation.title=annotation.shape=annotation.chart=annotation.options=null},update:function(options,redraw){extend(this.options,options),this.linkObjects(),this.render(redraw)},linkObjects:function(){var annotation=this,chart=annotation.chart,linkedTo=annotation.linkedObject,linkedId=linkedTo&&(linkedTo.id||linkedTo.options.id),options=annotation.options,id=options.linkedTo;defined(id)?defined(linkedTo)&&id===linkedId||(annotation.linkedObject=chart.get(id)):annotation.linkedObject=null}},extend(Chart.prototype,{annotations:{add:function(options,redraw){var item,len,annotations=this.allItems,chart=this.chart;for(isArray(options)||(options=[options]),len=options.length;len--;)item=new Annotation(chart,options[len]),annotations.push(item),item.render(redraw)},redraw:function(){each(this.allItems,function(annotation){annotation.redraw()})}}}),Chart.prototype.callbacks.push(function(chart){var group,options=chart.options.annotations;group=chart.renderer.g("annotations"),group.attr({zIndex:7}),group.add(),chart.annotations.allItems=[],chart.annotations.chart=chart,chart.annotations.group=group,isArray(options)&&options.length>0&&chart.annotations.add(chart.options.annotations),Highcharts.addEvent(chart,"redraw",function(){chart.annotations.redraw()})})}(Highcharts,HighchartsAdapter);