"use strict";!function(factory){"object"==typeof module&&module.exports?module.exports=factory:factory(Highcharts)}(function(Highcharts){!function(H){var noop=H.noop,color=H.color,defaultOptions=H.defaultOptions,each=H.each,extend=H.extend,format=H.format,objectEach=H.objectEach,pick=H.pick,wrap=H.wrap,Chart=H.Chart,seriesTypes=H.seriesTypes,PieSeries=seriesTypes.pie,ColumnSeries=seriesTypes.column,Tick=H.Tick,fireEvent=H.fireEvent,inArray=H.inArray,ddSeriesId=1;extend(defaultOptions.lang,{drillUpText:"\u25c1 Back to {series.name}"}),defaultOptions.drilldown={activeAxisLabelStyle:{cursor:"pointer",color:"#003399",fontWeight:"bold",textDecoration:"underline"},activeDataLabelStyle:{cursor:"pointer",color:"#003399",fontWeight:"bold",textDecoration:"underline"},animation:{duration:500},drillUpButton:{position:{align:"right",x:-10,y:10}}},H.SVGRenderer.prototype.Element.prototype.fadeIn=function(animation){this.attr({opacity:.1,visibility:"inherit"}).animate({opacity:pick(this.newOpacity,1)},animation||{duration:250})},Chart.prototype.addSeriesAsDrilldown=function(point,options){this.addSingleSeriesAsDrilldown(point,options),this.applyDrilldown()},Chart.prototype.addSingleSeriesAsDrilldown=function(point,ddOptions){var newSeries,pointIndex,level,levelNumber,last,colorProp,oldSeries=point.series,xAxis=oldSeries.xAxis,yAxis=oldSeries.yAxis,levelSeries=[],levelSeriesOptions=[];colorProp={color:point.color||oldSeries.color},this.drilldownLevels||(this.drilldownLevels=[]),levelNumber=oldSeries.options._levelNumber||0,(last=this.drilldownLevels[this.drilldownLevels.length-1])&&last.levelNumber!==levelNumber&&(last=undefined),ddOptions=extend(extend({_ddSeriesId:ddSeriesId++},colorProp),ddOptions),pointIndex=inArray(point,oldSeries.points),each(oldSeries.chart.series,function(series){series.xAxis!==xAxis||series.isDrilling||(series.options._ddSeriesId=series.options._ddSeriesId||ddSeriesId++,series.options._colorIndex=series.userOptions._colorIndex,series.options._levelNumber=series.options._levelNumber||levelNumber,last?(levelSeries=last.levelSeries,levelSeriesOptions=last.levelSeriesOptions):(levelSeries.push(series),levelSeriesOptions.push(series.options)))}),level=extend({levelNumber:levelNumber,seriesOptions:oldSeries.options,levelSeriesOptions:levelSeriesOptions,levelSeries:levelSeries,shapeArgs:point.shapeArgs,bBox:point.graphic?point.graphic.getBBox():{},color:point.isNull?new H.Color(color).setOpacity(0).get():color,lowerSeriesOptions:ddOptions,pointOptions:oldSeries.options.data[pointIndex],pointIndex:pointIndex,oldExtremes:{xMin:xAxis&&xAxis.userMin,xMax:xAxis&&xAxis.userMax,yMin:yAxis&&yAxis.userMin,yMax:yAxis&&yAxis.userMax},resetZoomButton:this.resetZoomButton},colorProp),this.drilldownLevels.push(level),xAxis&&xAxis.names&&(xAxis.names.length=0),(newSeries=level.lowerSeries=this.addSeries(ddOptions,!1)).options._levelNumber=levelNumber+1,xAxis&&(xAxis.oldPos=xAxis.pos,xAxis.userMin=xAxis.userMax=null,yAxis.userMin=yAxis.userMax=null),oldSeries.type===newSeries.type&&(newSeries.animate=newSeries.animateDrilldown||noop,newSeries.options.animation=!0)},Chart.prototype.applyDrilldown=function(){var levelToRemove,drilldownLevels=this.drilldownLevels;drilldownLevels&&0<drilldownLevels.length&&(levelToRemove=drilldownLevels[drilldownLevels.length-1].levelNumber,each(this.drilldownLevels,function(level){level.levelNumber===levelToRemove&&each(level.levelSeries,function(series){series.options&&series.options._levelNumber===levelToRemove&&series.remove(!1)})})),this.resetZoomButton&&(this.resetZoomButton.hide(),delete this.resetZoomButton),this.pointer.reset(),this.redraw(),this.showDrillUpButton()},Chart.prototype.getDrilldownBackText=function(){var lastLevel,drilldownLevels=this.drilldownLevels;if(drilldownLevels&&0<drilldownLevels.length)return(lastLevel=drilldownLevels[drilldownLevels.length-1]).series=lastLevel.seriesOptions,format(this.options.lang.drillUpText,lastLevel)},Chart.prototype.showDrillUpButton=function(){var attr,states,chart=this,backText=this.getDrilldownBackText(),buttonOptions=chart.options.drilldown.drillUpButton;this.drillUpButton?this.drillUpButton.attr({text:backText}).align():(states=(attr=buttonOptions.theme)&&attr.states,this.drillUpButton=this.renderer.button(backText,null,null,function(){chart.drillUp()},attr,states&&states.hover,states&&states.select).addClass("highcharts-drillup-button").attr({align:buttonOptions.position.align,zIndex:7}).add().align(buttonOptions.position,!1,buttonOptions.relativeTo||"plotBox"))},Chart.prototype.drillUp=function(){for(var seriesI,level,oldSeries,newSeries,oldExtremes,chart=this,drilldownLevels=chart.drilldownLevels,levelNumber=drilldownLevels[drilldownLevels.length-1].levelNumber,i=drilldownLevels.length,chartSeries=chart.series,addSeries=function(seriesOptions){var addedSeries;each(chartSeries,function(series){series.options._ddSeriesId===seriesOptions._ddSeriesId&&(addedSeries=series)}),(addedSeries=addedSeries||chart.addSeries(seriesOptions,!1)).type===oldSeries.type&&addedSeries.animateDrillupTo&&(addedSeries.animate=addedSeries.animateDrillupTo),seriesOptions===level.seriesOptions&&(newSeries=addedSeries)};i--;)if((level=drilldownLevels[i]).levelNumber===levelNumber){if(drilldownLevels.pop(),!(oldSeries=level.lowerSeries).chart)for(seriesI=chartSeries.length;seriesI--;)if(chartSeries[seriesI].options.id===level.lowerSeriesOptions.id&&chartSeries[seriesI].options._levelNumber===levelNumber+1){oldSeries=chartSeries[seriesI];break}oldSeries.xData=[],each(level.levelSeriesOptions,addSeries),fireEvent(chart,"drillup",{seriesOptions:level.seriesOptions}),newSeries.type===oldSeries.type&&(newSeries.drilldownLevel=level,newSeries.options.animation=chart.options.drilldown.animation,oldSeries.animateDrillupFrom&&oldSeries.chart&&oldSeries.animateDrillupFrom(level)),newSeries.options._levelNumber=levelNumber,oldSeries.remove(!1),newSeries.xAxis&&(oldExtremes=level.oldExtremes,newSeries.xAxis.setExtremes(oldExtremes.xMin,oldExtremes.xMax,!1),newSeries.yAxis.setExtremes(oldExtremes.yMin,oldExtremes.yMax,!1)),level.resetZoomButton&&(chart.resetZoomButton=level.resetZoomButton,chart.resetZoomButton.show())}fireEvent(chart,"drillupall"),this.redraw(),0===this.drilldownLevels.length?this.drillUpButton=this.drillUpButton.destroy():this.drillUpButton.attr({text:this.getDrilldownBackText()}).align(),this.ddDupes.length=[]},wrap(Chart.prototype,"showResetZoom",function(proceed){this.drillUpButton||proceed.apply(this,Array.prototype.slice.call(arguments,1))}),ColumnSeries.prototype.animateDrillupTo=function(init){if(!init){var newSeries=this,level=newSeries.drilldownLevel;each(this.points,function(point){var dataLabel=point.dataLabel;point.graphic&&point.graphic.hide(),dataLabel&&(dataLabel.hidden="hidden"===dataLabel.attr("visibility"),dataLabel.hidden||(dataLabel.hide(),point.connector&&point.connector.hide()))}),setTimeout(function(){newSeries.points&&each(newSeries.points,function(point,i){var verb=i===(level&&level.pointIndex)?"show":"fadeIn",inherit="show"===verb||undefined,dataLabel=point.dataLabel;point.graphic&&point.graphic[verb](inherit),dataLabel&&!dataLabel.hidden&&(dataLabel[verb](inherit),point.connector&&point.connector[verb](inherit))})},Math.max(this.chart.options.drilldown.animation.duration-50,0)),this.animate=noop}},ColumnSeries.prototype.animateDrilldown=function(init){var animateFrom,series=this,drilldownLevels=this.chart.drilldownLevels,animationOptions=this.chart.options.drilldown.animation,xAxis=this.xAxis;init||(each(drilldownLevels,function(level){series.options._ddSeriesId===level.lowerSeriesOptions._ddSeriesId&&((animateFrom=level.shapeArgs).fill=level.color)}),animateFrom.x+=pick(xAxis.oldPos,xAxis.pos)-xAxis.pos,each(this.points,function(point){point.shapeArgs.fill=point.color,point.graphic&&point.graphic.attr(animateFrom).animate(extend(point.shapeArgs,{fill:point.color||series.color}),animationOptions),point.dataLabel&&point.dataLabel.fadeIn(animationOptions)}),this.animate=null)},ColumnSeries.prototype.animateDrillupFrom=function(level){var animationOptions=this.chart.options.drilldown.animation,group=this.group,removeGroup=group!==this.chart.columnGroup,series=this;each(series.trackerGroups,function(key){series[key]&&series[key].on("mouseover")}),removeGroup&&delete this.group,each(this.points,function(point){var graphic=point.graphic,animateTo=level.shapeArgs,complete=function(){graphic.destroy(),group&&removeGroup&&(group=group.destroy())};graphic&&(delete point.graphic,animateTo.fill=level.color,animationOptions?graphic.animate(animateTo,H.merge(animationOptions,{complete:complete})):(graphic.attr(animateTo),complete()))})},PieSeries&&extend(PieSeries.prototype,{animateDrillupTo:ColumnSeries.prototype.animateDrillupTo,animateDrillupFrom:ColumnSeries.prototype.animateDrillupFrom,animateDrilldown:function(init){var level=this.chart.drilldownLevels[this.chart.drilldownLevels.length-1],animationOptions=this.chart.options.drilldown.animation,animateFrom=level.shapeArgs,start=animateFrom.start,startAngle=(animateFrom.end-start)/this.points.length;init||(each(this.points,function(point,i){var animateTo=point.shapeArgs;animateFrom.fill=level.color,animateTo.fill=point.color,point.graphic&&point.graphic.attr(H.merge(animateFrom,{start:start+i*startAngle,end:start+(i+1)*startAngle}))[animationOptions?"animate":"attr"](animateTo,animationOptions)}),this.animate=null)}}),H.Point.prototype.doDrilldown=function(_holdRedraw,category,originalEvent){var seriesOptions,chart=this.series.chart,drilldown=chart.options.drilldown,i=(drilldown.series||[]).length;for(chart.ddDupes||(chart.ddDupes=[]);i--&&!seriesOptions;)drilldown.series[i].id===this.drilldown&&-1===inArray(this.drilldown,chart.ddDupes)&&(seriesOptions=drilldown.series[i],chart.ddDupes.push(this.drilldown));fireEvent(chart,"drilldown",{point:this,seriesOptions:seriesOptions,category:category,originalEvent:originalEvent,points:category!==undefined&&this.series.xAxis.getDDPoints(category).slice(0)},function(e){var chart=e.point.series&&e.point.series.chart,seriesOptions=e.seriesOptions;chart&&seriesOptions&&(_holdRedraw?chart.addSingleSeriesAsDrilldown(e.point,seriesOptions):chart.addSeriesAsDrilldown(e.point,seriesOptions))})},H.Axis.prototype.drilldownCategory=function(x,e){objectEach(this.getDDPoints(x),function(point){point&&point.series&&point.series.visible&&point.doDrilldown&&point.doDrilldown(!0,x,e)}),this.chart.applyDrilldown()},H.Axis.prototype.getDDPoints=function(x){var ret=[];return each(this.series,function(series){var i,xData=series.xData,points=series.points;for(i=0;i<xData.length;i++)if(xData[i]===x&&series.options.data[i]&&series.options.data[i].drilldown){ret.push(!points||points[i]);break}}),ret},Tick.prototype.drillable=function(){var pos=this.pos,label=this.label,axis=this.axis,isDrillable="xAxis"===axis.coll&&axis.getDDPoints,ddPointsX=isDrillable&&axis.getDDPoints(pos);isDrillable&&(label&&ddPointsX.length?(label.drillable=!0,label.basicStyles||(label.basicStyles=H.merge(label.styles)),label.addClass("highcharts-drilldown-axis-label").css(axis.chart.options.drilldown.activeAxisLabelStyle).on("click",function(e){axis.drilldownCategory(pos,e)})):label&&label.drillable&&(label.styles={},label.css(label.basicStyles),label.on("click",null),label.removeClass("highcharts-drilldown-axis-label")))},wrap(Tick.prototype,"addLabel",function(proceed){proceed.call(this),this.drillable()}),wrap(H.Point.prototype,"init",function(proceed,series,options,x){var point=proceed.call(this,series,options,x),xAxis=series.xAxis,tick=xAxis&&xAxis.ticks[x];return point.drilldown&&H.addEvent(point,"click",function(e){series.xAxis&&!1===series.chart.options.drilldown.allowPointDrilldown?series.xAxis.drilldownCategory(point.x,e):point.doDrilldown(undefined,undefined,e)}),tick&&tick.drillable(),point}),wrap(H.Series.prototype,"drawDataLabels",function(proceed){var css=this.chart.options.drilldown.activeDataLabelStyle,renderer=this.chart.renderer;proceed.call(this),each(this.points,function(point){var dataLabelsOptions=point.options.dataLabels,pointCSS=pick(point.dlOptions,dataLabelsOptions&&dataLabelsOptions.style,{});point.drilldown&&point.dataLabel&&("contrast"===css.color&&(pointCSS.color=renderer.getContrast(point.color||this.color)),dataLabelsOptions&&dataLabelsOptions.color&&(pointCSS.color=dataLabelsOptions.color),point.dataLabel.addClass("highcharts-drilldown-data-label"),point.dataLabel.css(css).css(pointCSS))},this)});var applyCursorCSS=function(element,cursor,addClass){element[addClass?"addClass":"removeClass"]("highcharts-drilldown-point"),element.css({cursor:cursor})},drawTrackerWrapper=function(proceed){proceed.call(this),each(this.points,function(point){point.drilldown&&point.graphic&&applyCursorCSS(point.graphic,"pointer",!0)})},setPointStateWrapper=function(proceed,state){var ret=proceed.apply(this,Array.prototype.slice.call(arguments,1));return this.drilldown&&this.series.halo&&"hover"===state?applyCursorCSS(this.series.halo,"pointer",!0):this.series.halo&&applyCursorCSS(this.series.halo,"auto",!1),ret};objectEach(seriesTypes,function(seriesType){wrap(seriesType.prototype,"drawTracker",drawTrackerWrapper),wrap(seriesType.prototype.pointClass.prototype,"setState",setPointStateWrapper)})}(Highcharts)});