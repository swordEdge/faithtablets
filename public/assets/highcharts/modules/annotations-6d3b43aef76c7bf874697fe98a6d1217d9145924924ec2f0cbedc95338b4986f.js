"use strict";!function(factory){"object"==typeof module&&module.exports?module.exports=factory:factory(Highcharts)}(function(Highcharts){!function(H){var merge=H.merge,addEvent=H.addEvent,extend=H.extend,each=H.each,isString=H.isString,isNumber=H.isNumber,defined=H.defined,isObject=H.isObject,inArray=H.inArray,erase=H.erase,find=H.find,format=H.format,pick=H.pick,destroyObjectProperties=H.destroyObjectProperties,tooltipPrototype=H.Tooltip.prototype,seriesPrototype=H.Series.prototype,chartPrototype=H.Chart.prototype,defaultMarkers={arrow:{render:!1,id:"arrow",refY:5,refX:5,markerWidth:10,markerHeight:10,children:[{tagName:"path",attrs:{d:"M 0 0 L 10 5 L 0 10 Z",strokeWidth:0}}]}},MarkerMixin={markerSetter:function(markerType){return function(value){this.attr(markerType,"url(#"+value+")")}}};extend(MarkerMixin,{markerEndSetter:MarkerMixin.markerSetter("marker-end"),markerStartSetter:MarkerMixin.markerSetter("marker-start")}),H.SVGRenderer.prototype.addMarker=function(id,markerOptions){var markerId=pick(id,H.uniqueKey()),marker=this.createElement("marker").attr({id:markerId,markerWidth:pick(markerOptions.markerWidth,20),markerHeight:pick(markerOptions.markerHeight,20),refX:markerOptions.refX||0,refY:markerOptions.refY||0,orient:markerOptions.orient||"auto"}).add(this.defs),attrs={stroke:markerOptions.color||"none",fill:markerOptions.color||"rgba(0, 0, 0, 0.75)"},children=markerOptions.children;return marker.id=markerId,each(children,function(child){this.createElement(child.tagName).attr(merge(attrs,child.attrs)).add(marker)},this),marker};var MockPoint=H.MockPoint=function(chart,options){this.mock=!0,this.series={visible:!0,chart:chart,getPlotBox:seriesPrototype.getPlotBox},this.init(chart,options)},mockPoint=H.mockPoint=function(chart,mockPointOptions){return new MockPoint(chart,mockPointOptions)};MockPoint.prototype={init:function(chart,options){var xAxisId=options.xAxis,xAxis=defined(xAxisId)?chart.xAxis[xAxisId]||chart.get(xAxisId):null,yAxisId=options.yAxis,yAxis=defined(yAxisId)?chart.yAxis[yAxisId]||chart.get(yAxisId):null;xAxis?(this.x=options.x,this.series.xAxis=xAxis):this.plotX=options.x,yAxis?(this.y=options.y,this.series.yAxis=yAxis):this.plotY=options.y},translate:function(){var series=this.series,xAxis=series.xAxis,yAxis=series.yAxis,plotX=this.plotX,plotY=this.plotY,isInside=!0;xAxis&&(this.plotX=plotX=xAxis.toPixels(this.x,!0),isInside=0<=plotX&&plotX<=xAxis.len),yAxis&&(this.plotY=plotY=yAxis.toPixels(this.y,!0),isInside=isInside&&0<=plotY&&plotY<=yAxis.len),this.isInside=isInside},alignToBox:function(forceTranslate){forceTranslate&&this.translate();var temp,x=this.plotX,y=this.plotY;return this.series.chart.inverted&&(temp=x,x=y,y=temp),[x,y,0,0]},getLabelConfig:function(){return{x:this.x,y:this.y,point:this}}},H.defaultOptions.annotations=[];var Annotation=H.Annotation=function(chart,userOptions){this.chart=chart,this.labels=[],this.shapes=[],this.options=merge(this.defaultOptions,userOptions),this.init(chart,userOptions)};Annotation.prototype={shapesWithoutBackground:["connector"],attrsMap:{backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",strokeWidth:"stroke-width",stroke:"stroke",fill:"fill",zIndex:"zIndex",width:"width",height:"height",borderRadius:"r",r:"r",padding:"padding",dashStyle:"dashstyle"},defaultOptions:{visible:!0,labelOptions:{align:"center",allowOverlap:!1,backgroundColor:"rgba(0, 0, 0, 0.75)",borderColor:"black",borderRadius:1,borderWidth:1,crop:!1,formatter:function(){return defined(this.y)?this.y:"Annotation label"},overflow:"justify",padding:5,shadow:!1,shape:"callout",style:{fontSize:"11px",fontWeight:"normal",color:"contrast"},useHTML:!1,verticalAlign:"bottom",x:0,y:-16},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1,fill:"rgba(0, 0, 0, 0.75)",r:0},zIndex:6},init:function(){var anno=this;each(this.options.labels||[],this.initLabel,this),each(this.options.shapes||[],this.initShape,this),this.chart.labelCollectors.push(function(){var labels=[];return each(anno.labels,function(label){label.options.allowOverlap||labels.push(label)}),labels})},redraw:function(){this.group||this.render(),this.redrawItems(this.shapes),this.redrawItems(this.labels)},redrawItems:function(items){for(var i=items.length;i--;)this.redrawItem(items[i])},render:function(){var renderer=this.chart.renderer,group=this.group=renderer.g("annotation").attr({zIndex:this.options.zIndex,visibility:this.options.visible?"visible":"hidden"}).add();this.shapesGroup=renderer.g("annotation-shapes").add(group),this.labelsGroup=renderer.g("annotation-labels").attr({translateX:0,translateY:0}).add(group),this.shapesGroup.clip(this.chart.plotBoxClip)},setVisible:function(visibility){var options=this.options,visible=pick(visibility,!options.visible);this.group.attr({visibility:visible?"visible":"hidden"}),options.visible=visible},destroy:function(){var chart=this.chart;each(this.labels,function(label){label.destroy()}),each(this.shapes,function(shape){shape.destroy()}),destroyObjectProperties(this,chart)},initShape:function(shapeOptions){var renderer=this.chart.renderer,options=merge(this.options.shapeOptions,shapeOptions),attr=this.attrsFromOptions(options),type=renderer[options.type]?options.type:"rect",shape=renderer[type](0,-9e9,0,0);shape.points=[],shape.type=type,shape.options=options,shape.itemType="shape","path"===type&&extend(shape,{markerStartSetter:MarkerMixin.markerStartSetter,markerEndSetter:MarkerMixin.markerEndSetter,markerStart:MarkerMixin.markerStart,markerEnd:MarkerMixin.markerEnd}),shape.attr(attr),this.shapes.push(shape)},initLabel:function(labelOptions){var options=merge(this.options.labelOptions,labelOptions),style=options.style,attr=this.attrsFromOptions(options),label=this.chart.renderer.label("",0,-9e9,options.shape,null,null,options.useHTML,null,"annotation-label");"contrast"===style.color&&(style.color=this.chart.renderer.getContrast(-1<inArray(options.shape,this.shapesWithoutBackground)?"#FFFFFF":options.backgroundColor)),label.points=[],label.options=options,label.itemType="label",label.labelrank=options.labelrank,label.annotation=this,label.attr(attr).css(style).shadow(options.shadow),this.labels.push(label)},redrawItem:function(item){var text,points=this.linkPoints(item),itemOptions=item.options;points.length?(item.parentGroup||this.renderItem(item),"label"===item.itemType&&(text=itemOptions.format||itemOptions.text,item.attr({text:text?format(text,points[0].getLabelConfig()):itemOptions.formatter.call(points[0])})),"path"===item.type?this.redrawPath(item):this.alignItem(item,!item.placed)):this.destroyItem(item)},destroyItem:function(item){erase(this[item.itemType+"s"],item),item.destroy()},pointItem:function(pointOptions,point){return point&&null!==point.series||(isObject(pointOptions)?point=mockPoint(this.chart,pointOptions):isString(pointOptions)&&(point=this.chart.get(pointOptions)||null)),point},linkPoints:function(item){var i,point,pointsOptions=item.options.points||item.options.point&&H.splat(item.options.point),points=item.points,len=pointsOptions&&pointsOptions.length;for(i=0;i<len;i++){if(!(point=this.pointItem(pointsOptions[i],points[i])))return item.points=[];points[i]=point}return points},alignItem:function(item,isNew){var anchor=this.itemAnchor(item,item.points[0]),attrs=this.itemPosition(item,anchor);attrs?(item.alignAttr=attrs,item.placed=!0,attrs.anchorX=anchor.absolutePosition.x,attrs.anchorY=anchor.absolutePosition.y,item[isNew?"attr":"animate"](attrs)):(item.placed=!1,item.attr({x:0,y:-9e9}))},redrawPath:function(pathItem,isNew){var crispSegmentIndex,anchor,point,showPath,points=pathItem.points,strokeWidth=pathItem["stroke-width"],d=["M"],pointIndex=0,dIndex=0,len=points&&points.length;if(len)for(;point=points[pointIndex],anchor=this.itemAnchor(pathItem,point).absolutePosition,d[++dIndex]=anchor.x,d[++dIndex]=anchor.y,0===(crispSegmentIndex=dIndex%5)&&(d[crispSegmentIndex+1]===d[crispSegmentIndex+4]&&(d[crispSegmentIndex+1]=d[crispSegmentIndex+4]=Math.round(d[crispSegmentIndex+1])-strokeWidth%2/2),d[crispSegmentIndex+2]===d[crispSegmentIndex+5]&&(d[crispSegmentIndex+2]=d[crispSegmentIndex+5]=Math.round(d[crispSegmentIndex+2])+strokeWidth%2/2)),pointIndex<len-1&&(d[++dIndex]="L"),showPath=point.series.visible,++pointIndex<len&&showPath;);showPath?pathItem[isNew?"attr":"animate"]({d:d}):pathItem.attr({d:"M 0 "+-9e9}),pathItem.placed=showPath},renderItem:function(item){item.add("label"===item.itemType?this.labelsGroup:this.shapesGroup),this.setItemMarkers(item)},setItemMarkers:function(item){var itemOptions=item.options,chart=this.chart,markers=chart.options.defs.markers,fill=itemOptions.fill,color=defined(fill)&&"none"!==fill?fill:itemOptions.stroke;each(["markerStart","markerEnd"],function(markerType){var marker,predefinedMarker,key,markerId=itemOptions[markerType];if(markerId){for(key in markers)if(markerId===(marker=markers[key]).id){predefinedMarker=marker;break}predefinedMarker&&(marker=item[markerType]=chart.renderer.addMarker(null,merge(predefinedMarker,{color:color})),item.attr(markerType,marker.id))}})},itemAnchor:function(item,point){var plotBox=point.series.getPlotBox(),box=point.mock?point.alignToBox(!0):tooltipPrototype.getAnchor.call({chart:this.chart},point),anchor={x:box[0],y:box[1],height:box[2]||0,width:box[3]||0};return{relativePosition:anchor,absolutePosition:merge(anchor,{x:anchor.x+plotBox.translateX,y:anchor.y+plotBox.translateY})}},itemPosition:function(item,anchor){var itemPosition,alignTo,itemPosRelativeX,itemPosRelativeY,chart=this.chart,point=item.points[0],itemOptions=item.options,anchorAbsolutePosition=anchor.absolutePosition,anchorRelativePosition=anchor.relativePosition,showItem=point.series.visible&&!1!==point.isInside;return showItem&&(defined(itemOptions.distance)||itemOptions.positioner?itemPosition=(itemOptions.positioner||tooltipPrototype.getPosition).call({chart:chart,distance:pick(itemOptions.distance,16)},item.width,item.height,{plotX:anchorRelativePosition.x,plotY:anchorRelativePosition.y,negative:point.negative,ttBelow:point.ttBelow,h:anchorRelativePosition.height||anchorRelativePosition.width}):(alignTo={x:anchorAbsolutePosition.x,y:anchorAbsolutePosition.y,width:0,height:0},itemPosition=this.alignedPosition(extend(itemOptions,{width:item.width,height:item.height}),alignTo),"justify"===item.options.overflow&&(itemPosition=this.alignedPosition(this.justifiedOptions(item,itemOptions,itemPosition),alignTo))),itemOptions.crop&&(itemPosRelativeX=itemPosition.x-chart.plotLeft,itemPosRelativeY=itemPosition.y-chart.plotTop,showItem=chart.isInsidePlot(itemPosRelativeX,itemPosRelativeY)&&chart.isInsidePlot(itemPosRelativeX+item.width,itemPosRelativeY+item.height))),showItem?itemPosition:null},alignedPosition:function(alignOptions,box){var alignFactor,vAlignFactor,align=alignOptions.align,vAlign=alignOptions.verticalAlign,x=(box.x||0)+(alignOptions.x||0),y=(box.y||0)+(alignOptions.y||0);return"right"===align?alignFactor=1:"center"===align&&(alignFactor=2),alignFactor&&(x+=(box.width-(alignOptions.width||0))/alignFactor),"bottom"===vAlign?vAlignFactor=1:"middle"===vAlign&&(vAlignFactor=2),vAlignFactor&&(y+=(box.height-(alignOptions.height||0))/vAlignFactor),{x:Math.round(x),y:Math.round(y)}},justifiedOptions:function(label,alignOptions,alignAttr){var off,chart=this.chart,align=alignOptions.align,verticalAlign=alignOptions.verticalAlign,padding=label.box?0:label.padding||0,bBox=label.getBBox(),options={align:align,verticalAlign:verticalAlign,x:alignOptions.x,y:alignOptions.y,width:label.width,height:label.height},x=alignAttr.x-chart.plotLeft,y=alignAttr.y-chart.plotTop;return(off=x+padding)<0&&("right"===align?options.align="left":options.x=-off),(off=x+bBox.width-padding)>chart.plotWidth&&("left"===align?options.align="right":options.x=chart.plotWidth-off),(off=y+padding)<0&&("bottom"===verticalAlign?options.verticalAlign="top":options.y=-off),(off=y+bBox.height-padding)>chart.plotHeight&&("top"===verticalAlign?options.verticalAlign="bottom":options.y=chart.plotHeight-off),options},attrsFromOptions:function(options){var key,mappedKey,map=this.attrsMap,attrs={};for(key in options)(mappedKey=map[key])&&(attrs[mappedKey]=options[key]);return attrs}},H.extend(chartPrototype,{addAnnotation:function(userOptions,redraw){var annotation=new Annotation(this,userOptions);return this.annotations.push(annotation),pick(redraw,!0)&&annotation.redraw(),annotation},removeAnnotation:function(id){var annotations=this.annotations,annotation=find(annotations,function(annotation){return annotation.options.id===id});annotation&&(erase(annotations,annotation),annotation.destroy())},drawAnnotations:function(){var clip=this.plotBoxClip,plotBox=this.plotBox;clip?clip.attr(plotBox):this.plotBoxClip=this.renderer.clipRect(plotBox),each(this.annotations,function(annotation){annotation.redraw()})}}),chartPrototype.callbacks.push(function(chart){chart.annotations=[],each(chart.options.annotations,function(annotationOptions){chart.addAnnotation(annotationOptions,!1)}),chart.drawAnnotations(),addEvent(chart,"redraw",chart.drawAnnotations),addEvent(chart,"destroy",function(){var plotBoxClip=chart.plotBoxClip;plotBoxClip&&plotBoxClip.destroy&&plotBoxClip.destroy()})}),H.wrap(chartPrototype,"getContainer",function(p){p.call(this);var key,markers,marker,renderer=this.renderer,options=this.options;for(key in options.defs=merge(options.defs||{},{markers:defaultMarkers}),markers=options.defs.markers)marker=markers[key],pick(marker.render,!0)&&renderer.addMarker(marker.id,marker)}),H.SVGRenderer.prototype.symbols.connector=function(x,y,w,h,options){var path,yOffset,anchorX=options&&options.anchorX,anchorY=options&&options.anchorY,lateral=w/2;return isNumber(anchorX)&&isNumber(anchorY)&&(path=["M",anchorX,anchorY],(yOffset=y-anchorY)<0&&(yOffset=-h-yOffset),yOffset<w&&(lateral=anchorX<x+w/2?yOffset:w-yOffset),y+h<anchorY?path.push("L",x+lateral,y+h):anchorY<y?path.push("L",x+lateral,y):anchorX<x?path.push("L",x,y+h/2):x+w<anchorX&&path.push("L",x+w,y+h/2)),path||[]}}(Highcharts)});